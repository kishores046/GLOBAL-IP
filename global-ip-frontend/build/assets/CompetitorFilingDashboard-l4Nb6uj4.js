import{l as g,j as e,r as i}from"./index-BbdKGyFO.js";import{S as D}from"./Sidebar-i27tk-Tt.js";import{D as R}from"./DashboardHeader-CK3555d_.js";import{F as B}from"./file-text-CZhUgEQo.js";import{U as z}from"./users-D5aJHt4s.js";import{C as E}from"./calendar-DIk46_Ka.js";import{T as O}from"./trending-up-DZgQ1Bwi.js";import{R as H,C as U,X as P,Y as V,T as I,L as K,B as X}from"./generateCategoricalChart-ErmswnlQ.js";import{B as Y}from"./BarChart-BoJ-wFoZ.js";import{R as G}from"./refresh-cw-Bm27OB5K.js";import{C as _}from"./circle-check-big-CAMtQ4aA.js";import{C as q}from"./circle-alert-DdFSup5D.js";import"./search-BeavGINr.js";import"./chart-column-ulK0xHEq.js";import"./download-5qXpfTS0.js";import"./chevron-down-CAl0sHJA.js";import"./globe-CjcR3HKJ.js";import"./clsx-B-dksMZM.js";import"./string-cKWu9XK9.js";const h="/api/competitors/filings",b={syncLatestFilings:async s=>(await g.post(`${h}/sync`,null,{params:{fromDate:s}})).data,getFilingSummary:async()=>(await g.get(`${h}/summary`)).data,getFilingTrends:async s=>(await g.get(`${h}/trends`,{params:{fromDate:s}})).data,getMonthlyTrends:async s=>(await g.get(`${h}/trends/monthly`,{params:{fromDate:s}})).data,getFilingsForCompetitor:async s=>(await g.get(`${h}/competitor/${s}`)).data,getFilingsForCompetitorPaginated:async(s,l=0,d=50)=>(await g.get(`${h}/competitor/${s}/page`,{params:{page:l,size:d}})).data,searchFilings:async s=>(await g.post(`${h}/search`,s)).data};function J({summary:s,isLoading:l}){if(l)return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(o=>e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-md border border-slate-200 animate-pulse",children:[e.jsx("div",{className:"h-12 w-12 bg-slate-200 rounded-lg mb-4"}),e.jsx("div",{className:"h-4 bg-slate-200 rounded w-24 mb-2"}),e.jsx("div",{className:"h-8 bg-slate-200 rounded w-16"})]},o))});if(!s)return null;if(s.totalFilings===0)return e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 text-center",children:[e.jsx("p",{className:"text-blue-800 font-medium",children:"No filing data available yet"}),e.jsx("p",{className:"text-blue-600 text-sm mt-1",children:'Click "Sync Filings" to fetch patent data for your competitors'})]});const d=[{title:"Total Filings",value:(s?.totalFilings??0).toLocaleString(),icon:B,color:"blue"},{title:"Competitors Tracked",value:(s?.competitorsTracked??0).toLocaleString(),icon:z,color:"green"},{title:"Oldest Filing",value:s?.oldestFiling?new Date(s.oldestFiling).toLocaleDateString():"N/A",icon:E,color:"orange"},{title:"Newest Filing",value:s?.newestFiling?new Date(s.newestFiling).toLocaleDateString():"N/A",icon:O,color:"purple"}],n={blue:"bg-blue-100 text-blue-600",green:"bg-green-100 text-green-600",orange:"bg-orange-100 text-orange-600",purple:"bg-purple-100 text-purple-600"};return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:d.map(o=>e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-md border border-slate-200 hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg ${n[o.color]} flex items-center justify-center mb-4`,children:e.jsx(o.icon,{className:"w-6 h-6"})}),e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:o.title}),e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:o.value})]},o.title))})}function Q({trends:s,isLoading:l}){if(l)return e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-md border border-slate-200",children:[e.jsx("div",{className:"h-8 w-48 bg-slate-200 rounded mb-6 animate-pulse"}),e.jsx("div",{className:"h-80 bg-slate-100 rounded animate-pulse"})]});if(!Array.isArray(s)||s.length===0)return e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-md border border-slate-200",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-6",children:"Filing Trends by Competitor"}),e.jsx("div",{className:"h-80 flex items-center justify-center text-slate-500",children:"No filing data available for the selected period"})]});const d=s.map(n=>({name:n.competitorName,filings:n.count,code:n.competitorCode}));return e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-md border border-slate-200",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-6",children:"Filing Trends by Competitor"}),e.jsx(H,{width:"100%",height:400,children:e.jsxs(Y,{data:d,children:[e.jsx(U,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(P,{dataKey:"name",stroke:"#64748b",tick:{fontSize:12},angle:-45,textAnchor:"end",height:100}),e.jsx(V,{stroke:"#64748b",tick:{fontSize:12}}),e.jsx(I,{contentStyle:{backgroundColor:"#ffffff",border:"1px solid #e2e8f0",borderRadius:"8px"},formatter:n=>[n.toLocaleString(),"Filings"]}),e.jsx(K,{}),e.jsx(X,{dataKey:"filings",fill:"#3b82f6",name:"Filing Count",radius:[8,8,0,0]})]})})]})}function W({trends:s,isLoading:l}){if(l)return e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-md border border-slate-200",children:[e.jsx("div",{className:"h-8 w-48 bg-slate-200 rounded mb-6 animate-pulse"}),e.jsx("div",{className:"h-96 bg-slate-100 rounded animate-pulse"})]});if(!s||Object.keys(s).length===0)return e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-md border border-slate-200",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-6",children:"Monthly Filing Heatmap"}),e.jsx("div",{className:"h-96 flex items-center justify-center text-slate-500",children:"No monthly filing data available"})]});const d=Object.keys(s),n=new Set;d.forEach(a=>{Object.keys(s[a]).forEach(r=>n.add(r))});const o=Array.from(n).sort(),u=(()=>{let a=0;return d.forEach(r=>{Object.values(s[r]).forEach(c=>{c>a&&(a=c)})}),a})(),j=a=>{if(a===0)return"bg-slate-100";const r=Math.min(a/u,1);return r<.2?"bg-blue-100":r<.4?"bg-blue-200":r<.6?"bg-blue-400":r<.8?"bg-blue-500":"bg-blue-600"},y=a=>a===0?"text-slate-400":a/u>=.6?"text-white":"text-slate-900";return e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-md border border-slate-200",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-6",children:"Monthly Filing Heatmap"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-slate-200 bg-slate-50 px-4 py-2 text-left text-sm font-semibold text-slate-700 sticky left-0 z-10",children:"Competitor"}),o.map(a=>e.jsx("th",{className:"border border-slate-200 bg-slate-50 px-4 py-2 text-center text-sm font-semibold text-slate-700 min-w-[100px]",children:a},a))]})}),e.jsx("tbody",{children:d.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-slate-200 px-4 py-2 font-medium text-slate-900 bg-slate-50 sticky left-0 z-10",children:a}),o.map(r=>{const c=s[a][r]||0;return e.jsx("td",{className:`border border-slate-200 px-4 py-2 text-center font-semibold ${j(c)} ${y(c)} transition-colors`,title:`${a} - ${r}: ${c} filings`,children:c>0?c:"-"},r)})]},a))})]})}),e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Scale:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-6 h-4 bg-slate-100 border border-slate-300"}),e.jsx("span",{children:"0"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("div",{className:"w-6 h-4 bg-blue-100 border border-slate-300"})}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("div",{className:"w-6 h-4 bg-blue-200 border border-slate-300"})}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("div",{className:"w-6 h-4 bg-blue-400 border border-slate-300"})}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("div",{className:"w-6 h-4 bg-blue-500 border border-slate-300"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-6 h-4 bg-blue-600 border border-slate-300"}),e.jsx("span",{children:"Max"})]})]})]})}function fe(){const[s,l]=i.useState("2020-01-01"),[d,n]=i.useState(null),[o,f]=i.useState([]),[u,j]=i.useState(null),[y,a]=i.useState(!0),[r,c]=i.useState(!0),[L,w]=i.useState(!0),[N,v]=i.useState(!1),[F,p]=i.useState(null),[m,A]=i.useState(null),[M,S]=i.useState(!1);i.useEffect(()=>{C()},[]),i.useEffect(()=>{T(),k()},[s]);const C=async()=>{try{a(!0),p(null);const t=await b.getFilingSummary();n(t)}catch(t){if(t instanceof Error&&t.message.includes("404"))n({totalFilings:0,oldestFiling:null,newestFiling:null,competitorsTracked:0,byCompetitor:[]});else{const x=t instanceof Error?t.message:"Failed to load filing summary";p(x)}}finally{a(!1)}},T=async()=>{try{c(!0);const t=await b.getFilingTrends(s);f(Array.isArray(t)?t:[])}catch(t){const x=t instanceof Error?t.message:"Failed to load filing trends";p(x),f([])}finally{c(!1)}},k=async()=>{try{w(!0);const t=await b.getMonthlyTrends(s);j(t)}catch(t){const x=t instanceof Error?t.message:"Failed to load monthly trends";p(x)}finally{w(!1)}},$=async()=>{try{v(!0),p(null);const t=await b.syncLatestFilings(s);A(t),S(!0),await C(),await T(),await k()}catch(t){const x=t instanceof Error?t.message:"Failed to sync filings";p(x)}finally{v(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-slate-50 to-blue-100",children:[e.jsx(R,{userName:"Analyst"}),e.jsxs("div",{className:"flex",children:[e.jsx(D,{}),e.jsx("main",{className:"flex-1 p-8 overflow-y-auto",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-blue-900 mb-2",children:"Competitor Filing Trends"}),e.jsx("p",{className:"text-slate-600",children:"Analyze patent filing patterns and activity"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:$,disabled:N,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(G,{className:`w-5 h-5 ${N?"animate-spin":""}`}),N?"Syncing...":"Sync Filings"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-slate-700",children:[e.jsx(E,{className:"w-4 h-4"}),"From Date:"]}),e.jsx("input",{type:"date",value:s,onChange:t=>l(t.target.value),className:"px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]}),M&&m&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(_,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-green-800 font-medium",children:"Sync Completed Successfully"}),e.jsxs("div",{className:"text-green-700 text-sm mt-2 space-y-1",children:[e.jsxs("p",{children:["Competitors Processed: ",m.competitorsProcessed]}),e.jsxs("p",{children:["New Filings Found: ",m.newFilingsFound]}),e.jsxs("p",{children:["Duplicates Skipped: ",m.duplicatesSkipped]})]}),m.details&&m.details.length>0&&e.jsx("div",{className:"mt-3 space-y-1",children:m.details.map(t=>e.jsxs("p",{className:"text-xs text-green-600",children:[t.competitorCode,": ",t.newFilings," new, ",t.duplicates," duplicates",t.status==="FAILED"&&e.jsxs("span",{className:"text-red-600",children:[" - ",t.errorMessage]})]},t.competitorCode))})]}),e.jsx("button",{onClick:()=>S(!1),className:"text-green-600 hover:text-green-800",children:"âœ•"})]})}),F&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(q,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-800 font-medium",children:"Error loading data"}),e.jsx("p",{className:"text-red-700 text-sm mt-1",children:F})]})]}),e.jsx(J,{summary:d,isLoading:y}),e.jsx(Q,{trends:o,isLoading:r}),e.jsx(W,{trends:u,isLoading:L})]})})]})]})}export{fe as CompetitorFilingDashboard};

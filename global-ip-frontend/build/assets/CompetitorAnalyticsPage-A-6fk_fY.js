import{r as l,j as e,u as B}from"./index-BbdKGyFO.js";import{S as I}from"./Sidebar-i27tk-Tt.js";import{D as M}from"./DashboardHeader-CK3555d_.js";import{c as F,B as $,u as z}from"./useCompetitors-DMZRCXTv.js";import{F as U}from"./file-text-CZhUgEQo.js";import{C as J}from"./calendar-DIk46_Ka.js";import{T as y}from"./trending-up-DZgQ1Bwi.js";import{R as H,C as q,X as O,Y as V,T as K,L as X}from"./generateCategoricalChart-ErmswnlQ.js";import{L as Y,a as G}from"./LineChart-BiZFvvjk.js";import{S as W}from"./search-BeavGINr.js";import{F as Q}from"./funnel-XEEXkhx9.js";import{C as Z,a as _}from"./chevron-right-CQmTrNK7.js";import{R as ee}from"./refresh-cw-Bm27OB5K.js";import{C as k}from"./circle-alert-DdFSup5D.js";import"./users-D5aJHt4s.js";import"./chart-column-ulK0xHEq.js";import"./download-5qXpfTS0.js";import"./chevron-down-CAl0sHJA.js";import"./globe-CjcR3HKJ.js";import"./clsx-B-dksMZM.js";import"./string-cKWu9XK9.js";function te(s="2020-01-01"){const[u,o]=l.useState([]),[m,r]=l.useState(!0),[p,x]=l.useState(null),a=async i=>{const g=i||s||"2020-01-01";try{r(!0),x(null);const n=await F.getMonthlyTrends(g);o(n)}catch(n){const d=n instanceof Error?n.message:"Failed to load filing trends";x(d),o([])}finally{r(!1)}};return l.useEffect(()=>{a()},[s]),{trends:u,isLoading:m,error:p,refetch:a}}function se(){const[s,u]=l.useState(null),[o,m]=l.useState(!0),[r,p]=l.useState(null),x=async()=>{try{m(!0),p(null);const a=await F.getFilingSummary();u(a)}catch(a){const i=a instanceof Error?a.message:"Failed to load filing summary";p(i),u(null)}finally{m(!1)}};return l.useEffect(()=>{x()},[]),{summary:s,isLoading:o,error:r,refetch:x}}function ae({summary:s,isLoading:u}){const o=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A",m=[{icon:U,label:"Total Filings",value:s?.totalFilings?.toLocaleString()||"0",color:"blue"},{icon:$,label:"Competitors Tracked",value:s?.competitorsTracked?.toString()||"0",color:"purple"},{icon:J,label:"Oldest Filing",value:o(s?.oldestFilingDate),color:"green"},{icon:y,label:"Latest Filing",value:o(s?.latestFilingDate),color:"orange"}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:m.map((r,p)=>e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-md border border-slate-200 hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:`p-3 rounded-lg bg-${r.color}-100`,children:e.jsx(r.icon,{className:`w-6 h-6 text-${r.color}-600`})})}),u?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-8 bg-slate-200 rounded animate-pulse"}),e.jsx("div",{className:"h-4 bg-slate-100 rounded animate-pulse w-2/3"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-3xl font-bold text-slate-900 mb-1",children:r.value}),e.jsx("div",{className:"text-sm text-slate-600",children:r.label})]})]},p))})}const C=["#3B82F6","#10B981","#F59E0B","#8B5CF6","#EF4444","#06B6D4","#F97316","#EC4899"];function le({trends:s,isLoading:u}){const o=l.useMemo(()=>{if(!s||!Array.isArray(s)||s.length===0)return[];const a=new Set(s.map(d=>d.month)),i=new Set(s.map(d=>d.competitorCode)),g=Array.from(a).sort((d,c)=>d.localeCompare(c)),n=Array.from(i);return g.map(d=>{const c={month:d};return n.forEach(f=>{const j=s.find(h=>h.month===d&&h.competitorCode===f);c[f]=j?.filingCount||0}),c})},[s]),m=l.useMemo(()=>!s||!Array.isArray(s)||s.length===0?[]:Array.from(new Map(s.map(i=>[i.competitorCode,{code:i.competitorCode,displayName:i.competitorName}])).values()),[s]),[r,p]=l.useState(new Set),x=a=>{const i=new Set(r);i.has(a)?i.delete(a):i.add(a),p(i)};return u?e.jsxs("div",{className:"bg-white rounded-xl p-8 shadow-md border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(y,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Filing Activity Timeline"})]}),e.jsx("div",{className:"h-96 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Loading filing trends..."})]})})]}):!s||s.length===0?e.jsxs("div",{className:"bg-white rounded-xl p-8 shadow-md border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(y,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Filing Activity Timeline"})]}),e.jsx("div",{className:"h-96 flex items-center justify-center",children:e.jsx("p",{className:"text-slate-500",children:"No filing data available"})})]}):e.jsxs("div",{className:"bg-white rounded-xl p-8 shadow-md border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Filing Activity Timeline"})]}),e.jsx("div",{className:"text-sm text-slate-600",children:"Based on stored competitor filing data from PatentsView"})]}),e.jsx("div",{className:"flex flex-wrap gap-4 mb-6 pb-6 border-b border-slate-200",children:m.map((a,i)=>{const g=C[i%C.length],n=r.has(a.code);return e.jsxs("button",{onClick:()=>x(a.code),className:`flex items-center gap-2 px-4 py-2 rounded-lg border-2 transition-all ${n?"border-slate-200 bg-slate-50 opacity-50":"border-slate-300 bg-white hover:shadow-md"}`,children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:n?"#94A3B8":g}}),e.jsx("span",{className:"text-sm font-medium text-slate-700",children:a.displayName})]},a.code)})}),e.jsx(H,{width:"100%",height:400,children:e.jsxs(Y,{data:o,margin:{top:5,right:30,left:0,bottom:80},children:[e.jsx(q,{strokeDasharray:"3 3",stroke:"#E2E8F0"}),e.jsx(O,{dataKey:"month",stroke:"#64748B",style:{fontSize:"12px"},angle:-45,textAnchor:"end",height:80}),e.jsx(V,{stroke:"#64748B",style:{fontSize:"12px"},label:{value:"Number of Filings",angle:-90,position:"insideLeft",style:{fontSize:"12px"}}}),e.jsx(K,{contentStyle:{backgroundColor:"#FFFFFF",border:"1px solid #E2E8F0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"}}),e.jsx(X,{}),m.map((a,i)=>e.jsx(G,{type:"monotone",dataKey:a.code,name:a.displayName,stroke:C[i%C.length],strokeWidth:2,dot:{r:4},activeDot:{r:6},hide:r.has(a.code)},a.code))]})}),e.jsx("div",{className:"mt-4 text-xs text-slate-500 text-center",children:"Click on competitor names to show/hide their trend lines"})]})}function re({competitors:s}){const u=B(),[o,m]=l.useState([]),[r,p]=l.useState(!1),[x,a]=l.useState(0),[i,g]=l.useState(0),[n,d]=l.useState(!1),[c,f]=l.useState([]),[j,h]=l.useState("2020-01-01"),[v,E]=l.useState(""),[S,L]=l.useState("All"),[w,N]=l.useState(0),T=10;l.useEffect(()=>{if(s.length>0&&!n){const t=s.filter(b=>b.active).map(b=>b.id);f(t),d(!0)}},[s,n]);const A=async()=>{if(n)try{p(!0);const t={competitorIds:c.length>0?c:void 0,fromDate:j||void 0,toDate:v||void 0,jurisdiction:S!=="All"?S:void 0,page:w,size:T},b=await F.searchFilings(t);m(b.content),a(b.totalPages),g(b.totalElements)}catch{m([]),a(0),g(0)}finally{p(!1)}};l.useEffect(()=>{n&&A()},[w,c,j,v,S,n]);const D=t=>{f(b=>b.includes(t)?b.filter(R=>R!==t):[...b,t]),N(0)},P=t=>{u(`/patents/${t}`)};return e.jsxs("div",{className:"bg-white rounded-xl p-8 shadow-md border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Filing Details"})]}),e.jsxs("div",{className:"text-sm text-slate-600",children:[i.toLocaleString()," total filings"]})]}),e.jsxs("div",{className:"mb-6 p-4 bg-slate-50 rounded-lg border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Q,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Filters"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Competitors"}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:s.filter(t=>t.active).map(t=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:c.includes(t.id),onChange:()=>D(t.id),className:"rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700",children:t.displayName})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"From Date"}),e.jsx("input",{type:"date",value:j,onChange:t=>{h(t.target.value),N(0)},className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"To Date"}),e.jsx("input",{type:"date",value:v,onChange:t=>{E(t.target.value),N(0)},className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Jurisdiction"}),e.jsxs("select",{value:S,onChange:t=>{L(t.target.value),N(0)},className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"All",children:"All"}),e.jsx("option",{value:"US",children:"US"}),e.jsx("option",{value:"EP",children:"EP"}),e.jsx("option",{value:"CN",children:"CN"}),e.jsx("option",{value:"JP",children:"JP"})]})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-slate-200",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-slate-700",children:"Patent ID"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-slate-700",children:"Title"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-slate-700",children:"Competitor"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-slate-700",children:"Publication Date"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-slate-700",children:"Jurisdiction"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-slate-700",children:"Assignee"})]})}),e.jsxs("tbody",{children:[r&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Loading filings..."})]})})}),!r&&o.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-12 text-center text-slate-500",children:"No filings found"})}),!r&&o.length>0&&o.map(t=>e.jsxs("tr",{onClick:()=>P(t.patentId),className:"border-b border-slate-100 hover:bg-blue-50 cursor-pointer transition-colors",children:[e.jsx("td",{className:"py-3 px-4 text-sm font-mono text-blue-600 font-medium",children:t.patentId}),e.jsx("td",{className:"py-3 px-4 text-sm text-slate-700 max-w-md truncate",children:t.title}),e.jsx("td",{className:"py-3 px-4 text-sm text-slate-700",children:t.competitorName}),e.jsx("td",{className:"py-3 px-4 text-sm text-slate-600",children:new Date(t.publicationDate).toLocaleDateString()}),e.jsx("td",{className:"py-3 px-4 text-sm text-slate-600",children:t.jurisdiction}),e.jsx("td",{className:"py-3 px-4 text-sm text-slate-600 max-w-xs truncate",children:t.assignee||"N/A"})]},t.id))]})]})}),x>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-6 border-t border-slate-200",children:[e.jsxs("div",{className:"text-sm text-slate-600",children:["Page ",w+1," of ",x]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>N(t=>Math.max(0,t-1)),disabled:w===0,className:"px-4 py-2 border border-slate-300 rounded-lg text-slate-700 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Previous"]}),e.jsxs("button",{onClick:()=>N(t=>Math.min(x-1,t+1)),disabled:w>=x-1,className:"px-4 py-2 border border-slate-300 rounded-lg text-slate-700 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:["Next",e.jsx(_,{className:"w-4 h-4"})]})]})]})]})}function ke(){const{competitors:s,isLoading:u,error:o,refetch:m}=z(),{summary:r,isLoading:p,refetch:x}=se(),{trends:a,isLoading:i,refetch:g}=te("2020-01-01"),[n,d]=l.useState(!1),[c,f]=l.useState(null);l.useEffect(()=>{const h=()=>{document.visibilityState==="visible"&&j()};return document.addEventListener("visibilitychange",h),()=>document.removeEventListener("visibilitychange",h)},[]);const j=async()=>{d(!0),f(null);try{const h=await F.syncFilings("2020-01-01");f({type:"success",text:`Sync completed: ${h.newFilingsFound} new filings found, ${h.duplicatesSkipped} duplicates skipped`}),await Promise.all([m(),x(),g()]),setTimeout(()=>f(null),5e3)}catch(h){const v=h instanceof Error?h.message:"Failed to sync filings";f({type:"error",text:v}),console.error("Sync failed:",h)}finally{d(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-slate-50 to-blue-100",children:[e.jsx(M,{userName:"Analyst"}),e.jsxs("div",{className:"flex",children:[e.jsx(I,{}),e.jsx("main",{className:"flex-1 p-8 overflow-y-auto",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{className:"w-8 h-8 text-blue-600"}),e.jsx("h1",{className:"text-4xl font-bold text-blue-900",children:"Competitor Analytics"})]}),e.jsxs("button",{onClick:j,disabled:n,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Refresh data",children:[e.jsx(ee,{className:`w-5 h-5 ${n?"animate-spin":""}`}),n?"Refreshing...":"Refresh"]})]}),e.jsx("p",{className:"text-slate-600",children:"Monitor competitor patent filing activity and trends"})]}),o&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(k,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-800 font-medium",children:"Error loading competitors"}),e.jsx("p",{className:"text-red-700 text-sm mt-1",children:o})]})]}),c&&e.jsxs("div",{className:`border rounded-lg p-4 flex items-start gap-3 ${c.type==="success"?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsx(k,{className:`w-5 h-5 flex-shrink-0 mt-0.5 ${c.type==="success"?"text-green-600":"text-red-600"}`}),e.jsx("p",{className:c.type==="success"?"text-green-800":"text-red-800",children:c.text})]}),e.jsx(ae,{summary:r,isLoading:p}),e.jsx(le,{trends:a,isLoading:i}),!u&&s.length>0&&e.jsx(re,{competitors:s}),!u&&s.length===0&&!o&&e.jsxs("div",{className:"bg-white rounded-xl p-12 shadow-md border border-slate-200 text-center",children:[e.jsx(y,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-slate-700 mb-2",children:"No Competitors Tracked"}),e.jsx("p",{className:"text-slate-600",children:"Start tracking competitors to see their patent filing activity"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Data Source:"})," All visualizations are based on stored competitor filing data from PatentsView. Data is updated via scheduled jobs and reflects US patent filings only."]})})]})})]})]})}export{ke as CompetitorAnalyticsPage};
